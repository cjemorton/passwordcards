services:
  modern:
    build:
      context: .
      dockerfile: docker/Dockerfile.modern
    container_name: passwordcards_modern
    ports:
      - "3000:80"
    restart: unless-stopped

  legacy:
    build:
      context: .
      dockerfile: docker/Dockerfile.legacy
    container_name: passwordcards_legacy
    ports:
      - "3001:80"
    environment:
      # Set to 'dev' for local development (no HTTPS, no path restrictions)
      # Set to 'prod' for production deployment (force HTTPS, restrict paths)
      - HTACCESS_MODE=${HTACCESS_MODE:-dev}
      # Bypass password for rate limiting (IMPORTANT: Set this in your .env file)
      - BYPASS_PASSWORD=${BYPASS_PASSWORD}
      # Card generation limit (number of cards before timeout)
      - CARD_GENERATION_LIMIT=${CARD_GENERATION_LIMIT:-5}
      # Card generation timeout in seconds
      - CARD_GENERATION_TIMEOUT=${CARD_GENERATION_TIMEOUT:-300}
    restart: unless-stopped
